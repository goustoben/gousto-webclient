---
serviceName: webclient
region: eu-west-1
exposure: private
dns: webclient
owner: squad-radishes
rootVolumeSize: 16

messages:
 publish:
 consume:

alarms:
  cpuAmber: 61
  cpuRed: 80
  elbLatencyAmber: 0.8
  elbLatencyRed: 1.2

logs:
  - name: accessLogGroup
  - name: errorLogGroup
  - name: pm2Log
    filters:
      - name: errorCount
        pattern: '{$.log_level = \"error\"}'
        threshold: 7
      - name: criticalCount
        pattern: '{$.log_level = \"critical\"}'
        threshold: 1
      - name: unparseableCookieCount
        pattern: '{($.log_level = \"critical\") && ($.message =\"un-parsable cookie value*\")}'
        threshold: 1

  - name: apiTimeLog


scaling:
  type: cpu
  upAt: 60 # %
  upBy: 100 # %
  downAt: 30 # %
  downBy: 50 # %
  cooldown: 1200 # The amount of time, in seconds, after a scaling activity completes before any further trigger-related scaling activities can start.

healthCheck:
  target : 'HTTP:80/ping'
  healthyThreshold: 2
  unhealthyThreshold: 10
  interval: 5
  timeout: 4
  gracePeriod: 1080

environments:
  - name: staging
    instanceType: t2.small
    minInstanceSize: 1
    maxInstanceSize: 2
    desiredInstanceSize: 1
    availability: alwaysOn

    deployment:
      style: immutable
      minInstancesInService: 1
      maxBatchSize: 1

  - name: env-default
    instanceType: t2.small
    minInstanceSize: 1
    maxInstanceSize: 1
    desiredInstanceSize: 1
    availability: businessHours

    deployment:
      style: inline

  - name: production
    instanceType: t2.medium
    minInstanceSize: 2
    maxInstanceSize: 8
    desiredInstanceSize: 2
    availability: alwaysOn

    deployment:
      style: immutable
      minInstancesInService: 2
      maxBatchSize: 1
