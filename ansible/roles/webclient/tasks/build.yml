---

- name: install node
  shell: bash -lc "nvm install {{ node_version }}"
  register: output
  changed_when: "'already installed.' not in output.stderr"

- name: create alias directory
  file: path="{{ nvm_root }}/alias" state=directory

- name: set {{ node_version }} as default version
  copy: dest="{{ nvm_root }}/alias/default" content="{{ node_version }}"

- name: Install yarn
  sudo: yes
  command: npm install -g yarn

- name: Clean cached dependencies
  command: yarn cache clean
  args:
    chdir: "{{ directory }}"

- name: Install dependencies
  command: yarn install --immutable
  args:
    chdir: "{{ directory }}"

- name: Build dev app
  command: yarn build:dev
  args:
    chdir: "{{ directory }}"
